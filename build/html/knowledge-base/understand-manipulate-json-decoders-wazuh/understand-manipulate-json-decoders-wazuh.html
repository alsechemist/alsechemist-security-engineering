

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding &amp; Manipulating JSON Decoders - Wazuh &mdash; Security Engineering 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\css\lightbox.min.css?v=6e7d0de0" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\pointer.css?v=c97663ff" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom-styling/side-panel.css?v=1d19113b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=7310f75f"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\js\lightbox-plus-jquery.min.js?v=f0ca4bb6"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js?v=12818e64"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="IPTABLES - A Comprehensive Firewall Management Guide" href="../iptables-comprehensive-firewall-management/introduction.html" />
    <link rel="prev" title="Configuring Active Response for macOS Devices at Wazuh Manager" href="../configuration-active-response-macos/configuration-active-response-macos.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Security Engineering
              <img src="../../_static/alsechemist-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../main/about-alsechemist.html">About Alsechemist</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../projects/projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../research/research.html">Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge-base.html">Knowledge Base</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../projects/wazuh-tracecat-integration/introduction.html">Wazuh &amp; Tracecat Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/apache2-server-hardening/introduction.html">Apache2 Server Hardening</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/nginx-server-hardening/introduction.html">Nginx Server Hardening</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Research</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../research/modsecurity-log-detection-wazuh/introduction.html">Detecting ModSecurity Logs in Wazuh Using Custom Decoders and Rules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledge Base</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../configuration-active-response-macos/configuration-active-response-macos.html">Configuring Wazuh Active Response for macOS Agents</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Understanding &amp; Manipulating Wazuh JSON Decoders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#solution-1-using-the-decoder-exclude-tag">Solution - 1: Using the <code class="docutils literal notranslate"><span class="pre">decoder_exclude</span></code> tag</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-2-the-naming-convention-approach">Solution - 2: The Naming Convention Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#credits">Credits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../iptables-comprehensive-firewall-management/introduction.html">IPTables - Comprehensive Firewall Management</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Security Engineering</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Understanding &amp; Manipulating JSON Decoders - Wazuh</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="understanding-manipulating-json-decoders-wazuh">
<h1>Understanding &amp; Manipulating JSON Decoders - Wazuh<a class="headerlink" href="#understanding-manipulating-json-decoders-wazuh" title="Link to this heading"></a></h1>
<p>Before creating any custom decoder for JSON logs, it is crucial to understand how <code class="docutils literal notranslate"><span class="pre">JSON</span> <span class="pre">Decoders</span></code> actually work. We know that Wazuh already has its prebuilt JSON Decoder known as
<code class="docutils literal notranslate"><span class="pre">0006-json_decoders.xml</span></code>. Inside, if you inspect the decoder, the built-in generic json decoder has this prematch:</p>
<a class=""
               data-lightbox="group-ba2b0276-e852-42e0-8388-8130adda6633"
               href="../../_images/decoder-manipulation-11.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-11.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Observing 0006-json_decoders.xml Decoder"/>
                </a><div style="height:25px;"></div><p>This matches any JSON starting with <code class="docutils literal notranslate"><span class="pre">{&quot;</span></code>, so it captures logs before our custom decoder can process them. Since ruleset decoders load before
custom decoders in <code class="docutils literal notranslate"><span class="pre">/var/ossec/etc/decoders/</span></code>, the generic decoder always wins. So basically what this means, no matter what <code class="docutils literal notranslate"><span class="pre">decoder</span> <span class="pre">name</span></code> we give, the prebuilt
JSON Decoder will override the custom JSON decoders’ name. For example, observe the image below:</p>
<a class=""
               data-lightbox="group-b4c7bc76-4afb-4d90-a51b-66ee33b9bdb9"
               href="../../_images/decoder-manipulation-21.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-21.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="JSON Decoder Behavior"/>
                </a><div style="height:25px;"></div><p>To address this <strong>Decoder Name Override Problem</strong> from the root cause, we are going to look at two different approaches,</p>
<ol class="arabic simple">
<li><p>By using <code class="docutils literal notranslate"><span class="pre">&lt;decoder_exclude&gt;[decoder_name]&lt;/decoder_exclude&gt;</span></code> tag, to exclude the decoder that’s causing it.</p></li>
<li><p>A naming convention that Wazuh uses to execute its decoder by ascending order.</p></li>
</ol>
<section id="solution-1-using-the-decoder-exclude-tag">
<span id="solution-1"></span><h2>Solution - 1: Using the <code class="docutils literal notranslate"><span class="pre">decoder_exclude</span></code> tag<a class="headerlink" href="#solution-1-using-the-decoder-exclude-tag" title="Link to this heading"></a></h2>
<p>To follow along with this approach, it is required to exclude the prebuilt <code class="docutils literal notranslate"><span class="pre">0006-json_decoders.xml</span></code> decoder. Dont’t worry we are not fully excluding it.
Obviously, we care about the thing that come with the defaults. We are basically going to make it or represent it as <strong>not the inbuilt decoder itself</strong>.</p>
<ul>
<li><p><strong>Step - 1:</strong> Copy the content of <code class="docutils literal notranslate"><span class="pre">0006-json_decoders.xml</span></code> and paste it in <code class="docutils literal notranslate"><span class="pre">local_decoder.xml</span></code></p></li>
<li><p><strong>Step - 2:</strong> Exclude <code class="docutils literal notranslate"><span class="pre">0006-json_decoders.xml</span></code> decoder from executing in the Wazuh Manager.</p>
<blockquote>
<div><a class=""
               data-lightbox="group-b2c35b0a-2caa-451b-a206-558113156d10"
               href="../../_images/decoder-manipulation-31.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-31.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Excluding 0006-json_decoders.xml Decoder"/>
                </a><div style="height:25px;"></div><p>Save it, then restart the manager.</p>
</div></blockquote>
</li>
</ul>
<p>This method actually preserves the built-in features of <code class="docutils literal notranslate"><span class="pre">0006-json_decoders.xml</span></code> decoder while also making it usable for customization purposes.</p>
<p>To further see it into action and how it works, checkout the <a class="reference internal" href="../../research/modsecurity-log-detection-wazuh/decoder-creation.html"><span class="doc">Decoder Creation of ModSecurity JSON Logs</span></a>,
there the concept will be utilized for Detection Engineering.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Order matters! Custom JSON Decoders must be defined <code class="docutils literal notranslate"><span class="pre">BEFORE</span></code> the generic json decoder. Other it won’t work as decoders are prioritized by order.</p>
</div>
</section>
<section id="solution-2-the-naming-convention-approach">
<h2>Solution - 2: The Naming Convention Approach<a class="headerlink" href="#solution-2-the-naming-convention-approach" title="Link to this heading"></a></h2>
<p>In this approach, we are going to follow a simple naming convention that Wazuh uses to execute its decoders by ascending order.
This is only applicable if case scenarios like our, where we have multiple colliding decoder names overwriting each other.</p>
<p>First observe how Wazuh Decoders are actually named,</p>
<a class=""
               data-lightbox="group-42e1dda9-8731-4a1d-94ec-56886a3d47d9"
               href="../../_images/decoder-manipulation-41.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-41.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Wazuh Decoder Naming Convention"/>
                </a><div style="height:25px;"></div><p>Note that the decoder are named like <strong>000[*]-[decoder_name]</strong>, an usual ascending order approach.</p>
<p>If we name our decoders the same way, it will work just like the previous approach we have discussed earlier in <a class="reference internal" href="#solution-1"><span class="std std-ref">Solution - 1: Using the decoder_exclude tag</span></a>. The only difference is that,
we don’t have the need to use the <code class="docutils literal notranslate"><span class="pre">decoder_exclude</span></code> tag, here. In other words, it’s pretty much doing the same thing,
maintaining the name of the JSON Decoders in ascending order.</p>
<p>For example, if we consider the <a class="reference internal" href="../../research/modsecurity-log-detection-wazuh/decoder-creation.html"><span class="doc">Decoder Creation of ModSecurity JSON Logs</span></a> here as well,
instead of making the decoders in <code class="docutils literal notranslate"><span class="pre">local_decoder.xml</span></code> file, we would rather create a custom decoder file with the name <code class="docutils literal notranslate"><span class="pre">0000-modsecurity_decoder.xml</span></code> and
make the decoder there.</p>
<p>Refer to the images in the slider to have a high level view,</p>
<a class=""
               data-lightbox="group-solution-2"
               href="../../_images/decoder-manipulation-51.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-51.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Naming Custom Decoder"/>
                </a><a class=""
               data-lightbox="group-solution-2"
               href="../../_images/decoder-manipulation-61.png"
               title=""
               data-title=""
               
               ><img src="../../_images/decoder-manipulation-61.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Observing Custom Decoder - Success"/>
                </a><div style="height:25px;"></div><p>Notice that the test actually caught our decoder name without even using the <code class="docutils literal notranslate"><span class="pre">use_own_name</span></code> tag. This approach is much safer than the previous one, as we didn’t have to
alter any default configurations already set by Wazuh. And, this is also a more convenient approach.</p>
</section>
<section id="disclaimer">
<h2>Disclaimer<a class="headerlink" href="#disclaimer" title="Link to this heading"></a></h2>
<p>The above two solutions are best suited when you are dealing with multiple JSON logs emerging from multiple different entities. Such as, when you have to setup alerts for
Suricata, Zeek and ModSecurity JSON logs, or any JSON logs coming from multiple entities at the same time within the same Wazuh Cluster.</p>
<p>While the use cases are endless, the above 2 solutions, although serving the same cause, might come in handy across various scenarios. It is suggested to find out
what suits your scenario the best.</p>
</section>
<section id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Link to this heading"></a></h2>
<p>The solutions provided here are based on extensive community support and contributions from the Wazuh Community and Wazuh Ambassadors.
These solutions have been developed through continuous technical discussions and convenient implementations provided by highly skilled individuals within the community.</p>
<p>Special acknowledgment to the following Wazuh Ambassadors who have contributed significantly to these solutions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wazuh.com/ambassadors/jakub-pacowski/" rel="noreferrer" target="_blank">Jakub Pacowski <svg version="1.1" width="1.0em" height="1.0em" viewBox="0 0 16 16" aria-hidden="true" style="display: inline-block; vertical-align: middle; fill: currentColor;"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></p></li>
<li><p><a class="reference external" href="https://wazuh.com/ambassadors/kevin-branch/" rel="noreferrer" target="_blank">Kevin Branch <svg version="1.1" width="1.0em" height="1.0em" viewBox="0 0 16 16" aria-hidden="true" style="display: inline-block; vertical-align: middle; fill: currentColor;"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></p></li>
</ul>
<p>We deeply appreciate their dedication and expertise in helping develop and refine these JSON decoder manipulation techniques.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../configuration-active-response-macos/configuration-active-response-macos.html" class="btn btn-neutral float-left" title="Configuring Active Response for macOS Devices at Wazuh Manager" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../iptables-comprehensive-firewall-management/introduction.html" class="btn btn-neutral float-right" title="IPTABLES - A Comprehensive Firewall Management Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alsechemist.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>