

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connecting ModSecurity with NGINX &mdash; Security Engineering 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\css\lightbox.min.css?v=6e7d0de0" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\pointer.css?v=c97663ff" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom-styling/side-panel.css?v=1d19113b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=7310f75f"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\js\lightbox-plus-jquery.min.js?v=f0ca4bb6"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js?v=12818e64"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Setting Up ModSecurity Core Rule Set (CRS)" href="modsecurity-crs-setup.html" />
    <link rel="prev" title="Setting Up the ModSecurity NGINX Connector" href="modsecurity-connector-setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Security Engineering
              <img src="../../_static/alsechemist-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../main/about-alsechemist.html">About Alsechemist</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../research/research.html">Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/knowledge-base.html">Knowledge Base</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../wazuh-tracecat-integration/introduction.html">Wazuh &amp; Tracecat Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apache2-server-hardening/introduction.html">Apache2 Server Hardening</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="introduction.html">Nginx Server Hardening</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="scope-of-engagement.html">Scope of Engagement</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-setup.html">Setting Up ModSecurity</a></li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-connector-setup.html">Setting Up the ModSecurity NGINX Connector</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Connecting ModSecurity with NGINX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-integration-architecture">Understanding the Integration Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connector-role-and-function">Connector Role and Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-module-in-nginx">Loading the Module in NGINX</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attaching-the-modsecurity-engine-with-nginx">Attaching the ModSecurity Engine with NGINX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#turning-on-the-modsecurity-engine">Turning On the ModSecurity Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#turning-on-modsecurity-in-nginx">Turning On ModSecurity in Nginx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#verification">Verification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-crs-setup.html">Setting Up ModSecurity Core Rule Set (CRS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-post-installation-setup.html">Post Installation Setup - ModSecurity</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Research</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../research/modsecurity-log-detection-wazuh/introduction.html">Detecting ModSecurity Logs in Wazuh Using Custom Decoders and Rules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledge Base</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/configuration-active-response-macos/configuration-active-response-macos.html">Configuring Wazuh Active Response for macOS Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/manipulation-json-decoders-wazuh/manipulation-json-decoders-wazuh.html">Manipulating Wazuh JSON Decoders</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Security Engineering</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="introduction.html">Introduction - Nginx Server Hardening</a></li>
      <li class="breadcrumb-item active">Connecting ModSecurity with NGINX</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="connecting-modsecurity-with-nginx">
<h1>Connecting ModSecurity with NGINX<a class="headerlink" href="#connecting-modsecurity-with-nginx" title="Link to this heading"></a></h1>
<p>This section explains how <strong>ModSecurity v3 (libmodsecurity)</strong> is connected to <strong>NGINX</strong> using the <strong>ModSecurity–NGINX</strong> connector. While ModSecurity provides the
core Web Application Firewall (WAF) engine, it does not operate independently. The connector enables NGINX to pass HTTP transaction data to ModSecurity for
inspection and enforcement.</p>
<section id="understanding-the-integration-architecture">
<h2>Understanding the Integration Architecture<a class="headerlink" href="#understanding-the-integration-architecture" title="Link to this heading"></a></h2>
<p>ModSecurity v3 follows a <strong>decoupled architecture</strong>, where:</p>
<ul class="simple">
<li><p><strong>libmodsecurity</strong> acts as the detection and rule-processing engine</p></li>
<li><p><strong>NGINX</strong> acts as the web server and request handler</p></li>
<li><p><strong>ModSecurity-nginx</strong> serves as the communication bridge between them</p></li>
</ul>
<p>In this architecture, NGINX forwards each HTTP transaction to libmodsecurity, which evaluates the request against configured security rules and returns an
<code class="docutils literal notranslate"><span class="pre">allow</span></code> or <code class="docutils literal notranslate"><span class="pre">deny</span></code> decision.</p>
<p>This design improves modularity, performance, and maintainability compared to earlier embedded implementations.</p>
</section>
<section id="connector-role-and-function">
<h2>Connector Role and Function<a class="headerlink" href="#connector-role-and-function" title="Link to this heading"></a></h2>
<p>The ModSecurity NGINX connector performs the following key functions:</p>
<ul class="simple">
<li><p>Hooks into NGINX request processing phases</p></li>
<li><p>Passes HTTP request and response data to libmodsecurity</p></li>
<li><p>Applies rule evaluation results in real time</p></li>
<li><p>Enforces blocking or logging actions based on rule outcomes</p></li>
</ul>
<p>Without this connector, ModSecurity cannot operate within NGINX.</p>
</section>
<section id="loading-the-module-in-nginx">
<h2>Loading the Module in NGINX<a class="headerlink" href="#loading-the-module-in-nginx" title="Link to this heading"></a></h2>
<p>Edit the main NGINX configuration file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>/etc/nginx/nginx.conf
</pre></div>
</div>
<p>Add the following line <strong>at the very top</strong> of the configuration file:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">load_module</span><span class="w"> </span><span class="s">modules/ngx_http_modsecurity_module.so</span><span class="p">;</span>
</pre></div>
</div>
<p>Follow the image below to have high level view,</p>
<a class=""
               data-lightbox="group-cea4d28b-7cc0-4e4e-9c83-f2d2ab0a9bbc"
               href="../../_images/settingup-modsecurity-connector-nginx-21.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-connector-nginx-21.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Loading ngx_http_modsecurity_module.so Module on Nginx"/>
                </a><div style="height:25px;"></div><p>This directive must appear <strong>before</strong> the <cite>events</cite> and <cite>http</cite> blocks. Actually, it is always suggested to load the modules first at the beginning.</p>
</section>
<section id="attaching-the-modsecurity-engine-with-nginx">
<h2>Attaching the ModSecurity Engine with NGINX<a class="headerlink" href="#attaching-the-modsecurity-engine-with-nginx" title="Link to this heading"></a></h2>
<p>Now for the final step, it’s time to attach the ModSecurity Engine in the NGINX Server.
Remember that we have placed the <code class="docutils literal notranslate"><span class="pre">modsecurity.conf</span></code> file at <code class="docutils literal notranslate"><span class="pre">/usr/local/modsecurity</span></code> while going through the <a class="reference internal" href="modsecurity-setup.html#required-files-placement-reorganization"><span class="std std-ref">Required Files Placement - Reorganization</span></a> section.
This is the main configuration file of ModSecurity. We are going to load it in the http server configuration file of NGINX, basically including the Modsecurity engine in
the http server.</p>
<section id="turning-on-the-modsecurity-engine">
<h3>Turning On the ModSecurity Engine<a class="headerlink" href="#turning-on-the-modsecurity-engine" title="Link to this heading"></a></h3>
<p>Edit the main ModSecurity Configuration file at <code class="docutils literal notranslate"><span class="pre">/usr/local/modsecurity/modsecurity.conf</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>/usr/local/modsecurity/modsecurity.conf
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">SecRuleEngine</span> <span class="pre">DetectionOnly</span></code> with</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">SecRuleEngine</span><span class="w"> </span><span class="s">On</span>
</pre></div>
</div>
<p>Refer to the image below for high level view,</p>
<a class=""
               data-lightbox="group-16f5914b-7c57-465a-b603-de4255e73ace"
               href="../../_images/settingup-modsecurity-nginx-connection-11.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-nginx-connection-11.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Attaching ModSecurity Engine in NGINX Server Configuration File"/>
                </a><div style="height:25px;"></div><p>Basically ModSecurity is now turned On. Its engine is active.</p>
</section>
<section id="turning-on-modsecurity-in-nginx">
<h3>Turning On ModSecurity in Nginx<a class="headerlink" href="#turning-on-modsecurity-in-nginx" title="Link to this heading"></a></h3>
<p>Edit the main NGINX server configuration file at <code class="docutils literal notranslate"><span class="pre">/conf.d/default.conf</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>/etc/nginx/conf.d/default.conf
</pre></div>
</div>
<p>Add this line inside the <code class="docutils literal notranslate"><span class="pre">server</span></code> block</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">modsecurity</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
</pre></div>
</div>
<p>And add this line in the <code class="docutils literal notranslate"><span class="pre">location</span></code> block</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">modsecurity_rules_file</span><span class="w"> </span><span class="s">/usr/local/modsecurity/modsecurity.conf</span><span class="p">;</span>
</pre></div>
</div>
<p>Refer to the image below for high level view,</p>
<a class=""
               data-lightbox="group-c6644502-eecd-4fc5-a8f2-fbe38f23b87d"
               href="../../_images/settingup-modsecurity-nginx-connection-21.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-nginx-connection-21.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Attaching ModSecurity Engine in NGINX Server Configuration File"/>
                </a><div style="height:25px;"></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above two lines can also be added in the <code class="docutils literal notranslate"><span class="pre">server</span></code> block.
This will basically load the same configuration file across all the locations following centralized manner.</p>
</div>
</section>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Link to this heading"></a></h2>
<p>Test the NGINX configuration to confirm the module is loaded correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nginx<span class="w"> </span>-t
</pre></div>
</div>
<p>It should say the syntaxes are <code class="docutils literal notranslate"><span class="pre">ok</span></code> and the test is <strong>successfully</strong>!</p>
<p>At this stage, the ModSecurity connector is successfully integrated with NGINX, and the web server is ready to load ModSecurity rules and configurations.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modsecurity-connector-setup.html" class="btn btn-neutral float-left" title="Setting Up the ModSecurity NGINX Connector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="modsecurity-crs-setup.html" class="btn btn-neutral float-right" title="Setting Up ModSecurity Core Rule Set (CRS)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alsechemist.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>