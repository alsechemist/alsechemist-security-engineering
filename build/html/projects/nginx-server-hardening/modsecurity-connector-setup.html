

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setting Up the ModSecurity NGINX Connector &mdash; Security Engineering 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\css\lightbox.min.css?v=6e7d0de0" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\pointer.css?v=c97663ff" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom-styling/side-panel.css?v=1d19113b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=7310f75f"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\js\lightbox-plus-jquery.min.js?v=f0ca4bb6"></script>
      <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js?v=12818e64"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Setting Up ModSecurity Core Rule Set (CRS)" href="modsecurity-crs-setup.html" />
    <link rel="prev" title="Setting Up ModSecurity" href="modsecurity-setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Security Engineering
              <img src="../../_static/alsechemist-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../main/about-alsechemist.html">About Alsechemist</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../research/research.html">Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/knowledge-base.html">Knowledge Base</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../wazuh-tracecat-integration/introduction.html">Wazuh &amp; Tracecat Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apache2-server-hardening/introduction.html">Apache2 Server Hardening</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="introduction.html">Nginx Server Hardening</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="scope-of-work.html">Scope of Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-setup.html">Setting Up ModSecurity</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setting Up the ModSecurity NGINX Connector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download-the-official-release-modsecurity-nginx">Download the Official Release - (ModSecurity-nginx)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparing-nginx-source-code">Preparing NGINX Source Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-nginx-with-the-modsecurity-connector">Configuring NGINX with the ModSecurity Connector</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-module">Building the Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-module-via-reorganization">Installing the Module via Reorganization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-module-in-nginx">Loading the Module in NGINX</a></li>
<li class="toctree-l3"><a class="reference internal" href="#turing-on-the-modsecurity-engine-in-nginx">Turing ON the ModSecurity Engine in NGINX</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verification">Verification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-crs-setup.html">Setting Up ModSecurity Core Rule Set (CRS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="modsecurity-post-installation-setup.html">Post Installation Setup - ModSecurity</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Research</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../research/modsecurity-log-detection-wazuh/introduction.html">Detecting ModSecurity Logs in Wazuh Using Custom Decoders and Rules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledge Base</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/configuration-active-response-macos/configuration-active-response-macos.html">Configuring Wazuh Active Response for macOS Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge-base/manipulation-json-decoders-wazuh/manipulation-json-decoders-wazuh.html">Manipulating Wazuh JSON Decoders</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Security Engineering</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="introduction.html">Introduction - Nginx Server Hardening</a></li>
      <li class="breadcrumb-item active">Setting Up the ModSecurity NGINX Connector</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setting-up-the-modsecurity-nginx-connector">
<h1>Setting Up the ModSecurity NGINX Connector<a class="headerlink" href="#setting-up-the-modsecurity-nginx-connector" title="Link to this heading"></a></h1>
<p>After successfully building and installing <strong>ModSecurity v3 (libModSecurity)</strong>, the next step is to integrate it with <strong>NGINX</strong> using the official
<strong>ModSecurity-nginx connector</strong>. This connector acts as a bridge between NGINX and the ModSecurity engine, enabling NGINX to pass HTTP transaction data to
libModSecurity for inspection.</p>
<section id="download-the-official-release-modsecurity-nginx">
<h2>Download the Official Release - <a class="reference external" href="https://github.com/owasp-modsecurity/ModSecurity-nginx" rel="noreferrer" target="_blank">(ModSecurity-nginx) <svg version="1.1" width="1.0em" height="1.0em" viewBox="0 0 16 16" aria-hidden="true" style="display: inline-block; vertical-align: middle; fill: currentColor;"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a><a class="headerlink" href="#download-the-official-release-modsecurity-nginx" title="Link to this heading"></a></h2>
<p>Begin by downloading the latest official release of ModSecurity NGINX connector from their <a class="reference external" href="https://github.com/owasp-modsecurity/ModSecurity-nginx/releases" rel="noreferrer" target="_blank">Release <svg version="1.1" width="1.0em" height="1.0em" viewBox="0 0 16 16" aria-hidden="true" style="display: inline-block; vertical-align: middle; fill: currentColor;"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> Page</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://github.com/owasp-modsecurity/ModSecurity-nginx/releases/download/&lt;latest-release-version&gt;/&lt;nginx-connector-with-latest-release-version&gt;.tar.gz
</pre></div>
</div>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">&lt;latest-release-version&gt;</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">&lt;nginx-connector-with-latest-release-version&gt;</span></code> with their actual release version.</p>
<p>This repository contains the required source code that allows NGINX to interface with libModSecurity during compilation.</p>
</section>
<section id="preparing-nginx-source-code">
<h2>Preparing NGINX Source Code<a class="headerlink" href="#preparing-nginx-source-code" title="Link to this heading"></a></h2>
<p>The ModSecurity connector will be compiled as a <strong>dynamic module</strong> against the same version of NGINX that will be used in production.
You can also do it without the dynamic module, just the difference is that, it will be installed as inbuilt feature of NGINX rather than a module itself.</p>
<p>Download and extract the NGINX source code matching your installed version.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://nginx.org/download/&lt;nginx-with-latest-release-version&gt;.tar.gz
tar<span class="w"> </span>-xzvf<span class="w"> </span>&lt;nginx-with-latest-release-version&gt;
<span class="nb">cd</span><span class="w"> </span>&lt;nginx-with-latest-release-version&gt;
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The version name must be the same as the one we deployed during our production ready NGINX setup phase that we saw in the <a class="reference internal" href="prerequisites.html#setup-nginx-production"><span class="std std-ref">Setting Up NGINX</span></a> section.
Otherwise, there are high chances of version compatibility/collision issues.</p>
</div>
</section>
<section id="configuring-nginx-with-the-modsecurity-connector">
<h2>Configuring NGINX with the ModSecurity Connector<a class="headerlink" href="#configuring-nginx-with-the-modsecurity-connector" title="Link to this heading"></a></h2>
<p>Configure NGINX to build the ModSecurity connector as a dynamic module.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./configure<span class="w"> </span>--add-dynamic-module<span class="o">=</span>/path/to/ModSecurity-nginx<span class="w"> </span>--with-compat
</pre></div>
</div>
<p>If everything goes well, you will see an output similar to this image below,</p>
<a class=""
               data-lightbox="group-2cacf5b9-d9b9-47b9-8614-29a3ec333444"
               href="../../_images/settingup-modsecurity-connector-nginx-11.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-connector-nginx-11.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Configure Message - Successful"/>
                </a><div style="height:25px;"></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>–with-compat</cite> flag ensures binary compatibility with existing NGINX installations, allowing the module to be loaded dynamically without rebuilding
the entire NGINX binary.</p>
</div>
</section>
<section id="building-the-module">
<h2>Building the Module<a class="headerlink" href="#building-the-module" title="Link to this heading"></a></h2>
<p>Build the dynamic module using.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>modules
</pre></div>
</div>
<p>After building, it successfully, the ModSecurity module for nginx will be available as
<code class="docutils literal notranslate"><span class="pre">objs/ngx_http_modsecurity_module.so</span></code> under <code class="docutils literal notranslate"><span class="pre">&lt;nginx-with-latest-release-version&gt;</span></code> directory.</p>
</section>
<section id="installing-the-module-via-reorganization">
<h2>Installing the Module via Reorganization<a class="headerlink" href="#installing-the-module-via-reorganization" title="Link to this heading"></a></h2>
<p>Copy the compiled module to the NGINX modules directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>objs/ngx_http_modsecurity_module.so<span class="w"> </span>/usr/lib/nginx/modules
</pre></div>
</div>
<p>Directory <code class="docutils literal notranslate"><span class="pre">/usr/lib/nginx/modules</span></code> is symbolic link for <code class="docutils literal notranslate"><span class="pre">/etc/nginx/modules/</span></code>.
Which mean, any module you put there will also be dynamically available in <code class="docutils literal notranslate"><span class="pre">/etc/nginx/modules/</span></code> directory.</p>
</section>
<section id="loading-the-module-in-nginx">
<h2>Loading the Module in NGINX<a class="headerlink" href="#loading-the-module-in-nginx" title="Link to this heading"></a></h2>
<p>Edit the main NGINX configuration file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>/etc/nginx/nginx.conf
</pre></div>
</div>
<p>Add the following line <strong>at the very top</strong> of the configuration file:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">load_module</span><span class="w"> </span><span class="s">modules/ngx_http_modsecurity_module.so</span><span class="p">;</span>
</pre></div>
</div>
<p>Follow the image below to have high level view,</p>
<a class=""
               data-lightbox="group-e5110d54-9698-41ab-b66f-9926354be470"
               href="../../_images/settingup-modsecurity-connector-nginx-21.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-connector-nginx-21.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Loading ngx_http_modsecurity_module.so Module on Nginx"/>
                </a><div style="height:25px;"></div><p>This directive must appear <strong>before</strong> the <cite>events</cite> and <cite>http</cite> blocks. Actually, it is always suggested to load the modules first at the beginning.</p>
</section>
<section id="turing-on-the-modsecurity-engine-in-nginx">
<h2>Turing ON the ModSecurity Engine in NGINX<a class="headerlink" href="#turing-on-the-modsecurity-engine-in-nginx" title="Link to this heading"></a></h2>
<p>Now for the final step, it’s time to turn the ModSecurity Engine in the NGINX Server. Remember that we have placed the <code class="docutils literal notranslate"><span class="pre">modsecurity.conf</span></code> file at <code class="docutils literal notranslate"><span class="pre">/usr/local/modsecurity</span></code> while going through the <a class="reference internal" href="modsecurity-setup.html#required-files-placement-reorganization"><span class="std std-ref">Required Files Placement - Reorganization</span></a> section.
This is the main configuration file of ModSecurity. We are going to load it in the http server configuration file of NGINX, basically including the Modsecurity engine in
the http server.</p>
<p>Edit the main NGINX server configuration file at <code class="docutils literal notranslate"><span class="pre">/conf.d/default.conf</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>/etc/nginx/conf.d/default.conf
</pre></div>
</div>
<p>Add this line inside the <code class="docutils literal notranslate"><span class="pre">server</span></code> block</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">modsecurity</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
</pre></div>
</div>
<p>And add this line in the <code class="docutils literal notranslate"><span class="pre">location</span></code> block</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">modsecurity_rules_file</span><span class="w"> </span><span class="s">/usr/local/modsecurity/modsecurity.conf</span><span class="p">;</span>
</pre></div>
</div>
<p>Refer to the image below for high level view.</p>
<a class=""
               data-lightbox="group-bb9e4d3d-62ee-413c-92bf-6dfbc33f7209"
               href="../../_images/settingup-modsecurity-connector-nginx-31.png"
               title=""
               data-title=""
               
               ><img src="../../_images/settingup-modsecurity-connector-nginx-31.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt="Adding ModSecurity Engine in NGINX Server Configuration File"/>
                </a><div style="height:25px;"></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above two lines can also be added in the <code class="docutils literal notranslate"><span class="pre">server</span></code> block.
This will basically load the same configuration file across all the locations following centralized manner.</p>
</div>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Link to this heading"></a></h2>
<p>Test the NGINX configuration to confirm the module is loaded correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nginx<span class="w"> </span>-t
</pre></div>
</div>
<p>It should say the syntaxes are <code class="docutils literal notranslate"><span class="pre">ok</span></code> and the test is <strong>successfully</strong>!</p>
<p>At this stage, the ModSecurity connector is successfully integrated with NGINX, and the web server is ready to load ModSecurity rules and configurations.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modsecurity-setup.html" class="btn btn-neutral float-left" title="Setting Up ModSecurity" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="modsecurity-crs-setup.html" class="btn btn-neutral float-right" title="Setting Up ModSecurity Core Rule Set (CRS)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alsechemist.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>